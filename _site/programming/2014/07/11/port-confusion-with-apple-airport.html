<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Port Confusion With Apple Airport</title>
        <meta name="viewport" content="width=device-width"/>
        <link href='http://fonts.googleapis.com/css?family=Roboto' 
            rel='stylesheet' type='text/css'>
            
        <link rel="stylesheet" href="/css/syntax.css"/>
        <link rel="stylesheet" href="/css/main.css" type="text/css" media="screen"/>
        <link rel="stylesheet" href="/css/print.css" type="text/css" media="print"/>
    </head>
    <body>
        <div class="site">
          <div class="header">
            <h1><a href="/">Demian Neidetcher</a> | Port Confusion With Apple Airport</h1>
          </div>
          <div class="post">
<p>This won&#39;t add anything to the knowledge that <a href="http://blog.nephtaliproject.com/?p=129">already exists online</a> but 
hopefully it&#39;s more searchable for the next poor sap that is confused by this.</p>

<h2>Locking Down my Server</h2>

<p><a href="http://neidetcher.com">This site</a> runs on a tiny <a href="http://www.rackspace.com/">Rackspace</a> server.  I&#39;m no expert but 
one of the easiest things you can do to lock down your server is to shut down as many ports as possible.  That 
means that you don&#39;t have potentially vulnerable software listening in on ports.  </p>

<p>You&#39;ll probably do some <code>nmap</code>.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">demian@raven ~&gt;nmap localhost

Starting Nmap 5.00 ( http://nmap.org ) at 2014-07-11 09:51 CDT
Interesting ports on localhost (127.0.0.1):
Not shown: 997 closed ports
PORT    STATE SERVICE
22/tcp  open  ssh
80/tcp  open  http
443/tcp open  https

Nmap done: 1 IP address (1 host up) scanned in 0.10 seconds
</code></pre></div>
<p>And maybe some <code>netstat</code>.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">demian@raven ~&gt;netstat -l
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State      
tcp        0      0 *:https                 *:*                     LISTEN     
tcp        0      0 *:www                   *:*                     LISTEN     
tcp        0      0 *:ssh                   *:*                     LISTEN     
tcp6       0      0 [::]:ssh                [::]:*                  LISTEN     
Active UNIX domain sockets (only servers)
Proto RefCnt Flags       Type       State         I-Node   Path
unix  2      [ ACC ]     STREAM     LISTENING     83108    /var/run/acpid.socket
</code></pre></div>
<p>I checked it locally and noticed that <code>exim4</code> was running and had a port open.  So I made sure that service was no
longer in the startup scripts and <a href="https://wiki.debian.org/Daemon">removed the daemon</a>.</p>

<h2>Now Try from Laptop</h2>

<p>Just to be sure I ran it from <code>nmap</code> from my laptop.  This is what I saw.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">demian  ~  nmap neidetcher.com

Starting Nmap 6.40 ( http://nmap.org ) at 2014-07-11 09:30 CDT
Nmap scan report for neidetcher.com (184.106.150.226)
Host is up (0.057s latency).
rDNS record for 184.106.150.226: foo.com
Not shown: 992 closed ports
PORT     STATE SERVICE
21/tcp   open  ftp
22/tcp   open  ssh
80/tcp   open  http
443/tcp  open  https
554/tcp  open  rtsp
3128/tcp open  squid-http
7070/tcp open  realserver
8080/tcp open  http-proxy

Nmap done: 1 IP address (1 host up) scanned in 0.87 seconds
</code></pre></div>
<p>Whoah, that&#39;s a lot of ports.  Obviously some hacker syndicate from Eastern Europe has replaced my version of <code>nmap</code>
such that it doesn&#39;t show the ports they have used to turn my server into a slave for 
their <a href="https://en.wikipedia.org/wiki/Botnet">botnet</a>.</p>

<h2>Apple Airport</h2>

<p>I ran across <a href="http://blog.nephtaliproject.com/?p=129">this blog post</a>.  The deal is that Apple Airport will 
try to proxy protocols for you.  Apparently it doesn&#39;t bother to check with the far-end servers to see if the
port is even available.  So, to you on your computer behind an Apple router, <code>nmap</code> will think the port is hot.</p>

</div>

          <div class="footer">
          This work is licensed under a
          <a rel="license" 
            href="http://creativecommons.org/licenses/by/4.0/deed.en_US"
            >Creative Commons Attribution 4.0 International License</a>.
          </div>
          <div class="printonly">
            http://neidetcher.com/programming/2014/07/11/port-confusion-with-apple-airport.html<br/>
            <img src="/assets/images/resume_qrcode.png"/>
          </div>
        </div>
    </body>
</html>
