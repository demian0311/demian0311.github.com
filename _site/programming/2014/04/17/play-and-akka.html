<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Play And Akka</title>
        <meta name="viewport" content="width=device-width"/>
        <link href='http://fonts.googleapis.com/css?family=Roboto' 
            rel='stylesheet' type='text/css'>
            
        <link rel="stylesheet" href="/css/syntax.css"/>
        <link rel="stylesheet" href="/css/main.css" type="text/css" media="screen"/>
        <link rel="stylesheet" href="/css/print.css" type="text/css" media="print"/>
    </head>
    <body>
        <div class="site">
          <div class="header">
            <h1><a href="/">Demian Neidetcher</a> | Play And Akka</h1>
          </div>
          <div class="post">
<p>I took another lab week to stumble around with the <a href="http://www.playframework.com/">Play Framework</a>.  I really 
like the way routing works, the controllers 
are nice and simple.  It has all come a long way
and I wish I could use it for my day job.  If I were
doing a green-fiedl web-app with some APIs I&#39;d likely 
reach for Play.</p>

<p>I wanted to learn a little bit more about <a href="https://en.wikipedia.org/wiki/Reactive_programming">reactive programming</a>.  I&#39;m not bought in enough to go sign the 
<a href="http://www.reactivemanifesto.org/">reactive manifesto</a> quite yet.  But a lot of smart people seem to be into it so again I thought I&#39;d look into it.  I put 
<a href="https://github.com/demian0311/ricochet">this project up on GitHub</a>.</p>

<h2>Actor</h2>

<p>Here&#39;s <a href="https://github.com/demian0311/ricochet/blob/master/app/actors/PersistorActor.scala">my actor</a>.  It uses a Scala object singleton to sort of simulate some 
back-end persistence.  </p>
<div class="highlight"><pre><code class="scala language-scala" data-lang="scala"><span class="k">package</span> <span class="nn">actors</span>

<span class="k">import</span> <span class="nn">akka.actor.Actor</span>
<span class="k">import</span> <span class="nn">utils._</span>
<span class="k">import</span> <span class="nn">play.api.mvc.Results</span>

<span class="k">class</span> <span class="nc">PersistorActor</span> <span class="k">extends</span> <span class="nc">Actor</span> <span class="k">with</span> <span class="nc">Results</span> <span class="o">{</span>

  <span class="k">def</span> <span class="n">receive</span> <span class="k">=</span> <span class="o">{</span>
    <span class="k">case</span> <span class="nc">TimerEventPost</span><span class="o">(</span><span class="n">path</span><span class="o">,</span> <span class="nc">TimerEvent</span><span class="o">(</span><span class="n">duration</span><span class="o">,</span> <span class="n">dateTime</span><span class="o">))</span> <span class="k">=&gt;</span> <span class="o">{</span>
      <span class="nc">GaugePersistence</span><span class="o">.</span><span class="n">persist</span><span class="o">(</span><span class="nc">TimerEventPost</span><span class="o">(</span><span class="n">path</span><span class="o">,</span> <span class="nc">TimerEvent</span><span class="o">(</span><span class="n">duration</span><span class="o">,</span> <span class="n">dateTime</span><span class="o">)))</span>
    <span class="o">}</span>
    <span class="k">case</span> <span class="nc">TimerEventRequest</span><span class="o">(</span><span class="n">path</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="o">{</span>
      <span class="n">sender</span><span class="o">.</span><span class="n">forward</span><span class="o">(</span><span class="nc">GaugePersistence</span><span class="o">.</span><span class="n">report</span><span class="o">(</span><span class="nc">TimerEventRequest</span><span class="o">(</span><span class="n">path</span><span class="o">)))</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<h2>Controller/ Actor Client</h2>

<p>Below is my Play Framework controller (<a href="https://github.com/demian0311/ricochet/blob/master/app/controllers/ReactiveGauge.scala">full source</a>) that creates a pool of actors.
I&#39;m thankful that <a href="http://blog.evilmonkeylabs.com/2013/01/17/Distributing_Akka_Workloads_And_Shutting_Down_After/">Evil Monkey Labs</a>
posted some code on how to easily create a pool of Actors.
The Akka documentation wasn&#39;t very straight-forward to me.  I have to admit I didn&#39;t
read it end to end, I was doing more random access.</p>
<div class="highlight"><pre><code class="scala language-scala" data-lang="scala"><span class="k">implicit</span> <span class="k">val</span> <span class="n">timeout</span> <span class="k">=</span> <span class="nc">Timeout</span><span class="o">(</span><span class="mi">10000</span><span class="o">)</span>

<span class="k">val</span> <span class="n">system</span> <span class="k">=</span> <span class="nc">ActorSystem</span><span class="o">(</span><span class="s">&quot;SimpleSystem&quot;</span><span class="o">)</span>
<span class="k">val</span> <span class="n">persistorActor</span><span class="k">:</span> <span class="kt">ActorRef</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">actorOf</span><span class="o">(</span><span class="nc">Props</span><span class="o">[</span><span class="kt">PersistorActor</span><span class="o">].</span><span class="n">withRouter</span><span class="o">(</span>
    <span class="nc">RoundRobinRouter</span><span class="o">(</span><span class="n">nrOfInstances</span> <span class="k">=</span> <span class="mi">100</span><span class="o">)</span>
<span class="o">),</span> <span class="n">name</span> <span class="k">=</span> <span class="s">&quot;simpleRoutedActor&quot;</span><span class="o">)</span>
</code></pre></div>
<p>This is the actor usage example that you always see.  This is async, fire and
forget.  This goes right on a different thread so the actor can do it&#39;s work.</p>
<div class="highlight"><pre><code class="scala language-scala" data-lang="scala"><span class="n">persistorActor</span> <span class="o">!</span> <span class="nc">TimerEventPost</span><span class="o">(</span><span class="n">path</span><span class="o">,</span> <span class="nc">TimerEvent</span><span class="o">(</span><span class="n">durationOpt</span><span class="o">.</span><span class="n">get</span><span class="o">))</span>
</code></pre></div>
<p>This is the less than typical way of using actors.  We actually want to get 
a response here.  This uses the implicit timeout from above. </p>
<div class="highlight"><pre><code class="scala language-scala" data-lang="scala"><span class="n">persistorActor</span><span class="o">.</span><span class="n">ask</span><span class="o">(</span><span class="nc">TimerEventRequest</span><span class="o">(</span><span class="n">path</span><span class="o">)).</span><span class="n">mapTo</span><span class="o">[</span><span class="kt">SimpleResult</span><span class="o">]</span>
</code></pre></div>
<h2>More stuff to learn</h2>

<p>Here are some things that I think I need to learn with respect to Akka and actors.</p>

<ul>
<li>dependency injection with actors <a href="http://scaldi.org/Scaldi.html">scaldi</a> seems to be a good solution</li>
<li>creating a hierarchy of actors</li>
<li>configuring actor pools and dispatching</li>
<li>remoting Actors</li>
<li>handling dead letter situations</li>
</ul>

</div>

          <div class="footer">
          <div class="printonly">http://neidetcher.com/programming/2014/04/17/play-and-akka.html</div>
          This work is licensed under a 
          <a rel="license" 
            href="http://creativecommons.org/licenses/by/4.0/deed.en_US"
            >Creative Commons Attribution 4.0 International License</a>.
          </div>
        </div>
    </body>
</html>
